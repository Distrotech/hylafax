<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<TITLE>
HylaFAX Server Operation
</TITLE>
</HEAD>

<BODY>

<BASEFONT SIZE=4>
<B><FONT SIZE=+3>H</FONT>YLA<FONT SIZE=+1>FAX</FONT> <FONT SIZE=+2>S</FONT>ERVER <FONT SIZE=+2>O</FONT>PERATION</B>
<BASEFONT SIZE=3>

<HR SIZE=4>

In normal operation HylaFAX server machines run four independent programs:

<UL>
<LI>faxq, the central scheduler process
<LI>faxgetty, the ``front door'' program that handles incoming calls,
<LI>hfaxd, the program that handles the client-server protocol for
   submitting jobs and retrieving status information, and
<LI>faxqclean, the spooling area cleaner process.
</UL>

The faxq scheduler process is normally started once when the system is booted.
If faxgetty processes are to be used, they should be setup so that the
<A HREF="@CGIPATH@/manpage?init">init</A>. 
program will start them on each port where a fax
modem resides.
The hfaxd program can be run either as a standalone server process or
started by the
<A HREF="@CGIPATH@/manpage?inetd">inetd</A>
process; the intent is that it run standalone.
faxqclean handles the delayed purging and archiving of outbound jobs
and is intended to be run from
<A HREF="@CGIPATH@/manpage?cron">cron</A>
regularly (how regularly is a decision for the system administrator).

<P>
Under a System V-based operating system
the normal installation procedure sets up the 
system so the faxq and hfaxd processes are started up by
<A HREF="@CGIPATH@/manpage?init">init</A>. 
On other systems you will need to arrange for this yourself
(typically by editing <B>/etc/rc.local</B> or similar).
faxgetty processes must be manually setup by editing the appropriate
control file for init; usually either <B>/etc/inittab</B> or
<B>/etc/ttytab</B>.
hfaxd can be setup to be started by inetd when the faxsetup script
is run to configure a system for use with HylaFAX.

<P>
If you need to start the faxq server by
hand, consult the
<A HREF="@CGIPATH@/manpage?faxq">faxq</A>
manual page and the shell script <B>etc/hylafax</B>
that is used on System V-based systems.

<P>
Incoming facsimile are placed in the <B>recvq</B> subdirectory of the spooling
area and probably will need to be cleaned up periodically.  Likewise
there is logging information in the <B>log</B> subdirectory and accounting
information in the <B>etc</B> subdirectory of the spooling area that may need
some attention.

<P>
<IMG SRC="icons/info_icon.gif" ALIGN=left HSPACE=10>
<EM>The
<A HREF="@CGIPATH@/manpage?faxcron">faxcron</A>
script is designed to handle the
periodic maintenance of the spooling area.  This script is designed to
be run from
<A HREF="@CGIPATH@/manpage?cron">cron</A>
every day.</EM>

<P>
If you want to do accounting check out the
<A HREF="@CGIPATH@/manpage?xferfaxstats">xferfaxstats</A>
and
<A HREF="@CGIPATH@/manpage?recvstats">recvstats</A>
scripts for a basic attack on how to process the
<A HREF="@CGIPATH@/xferfaxlog?4+xferfaxlog"><B>etc/xferfaxlog</B></A>
accounting file that has records of all
facsimile transmissions and receptions.
Note that faxcron uses these
scripts to deliver statistics about facsimile that were
recently transmitted and received.

<P>
Otherwise the only matter to be concerned with is the support for data
connections.  If your modems are capable of differentiating data
connections from facsimile connections the fax server can be configured
to startup a getty 
program whenever a call from a data modem is received.
Alternatively, if
your modem does not support an adaptive-answer facility, but it is a
Class 1 modem, the server may be able to do
<A HREF="setup-advanced.html#AdaptiveAnswer">adaptive answering in software</A>.
In any event, beware that if you enable data connections you
should take the normal precautions you would take when there are dialup
ports on your machine.  Specifically, make sure that you have
passwords, appropriate file protections, and proper configuration of
<I>uucp</I> or similar.

<P>
If you encounter problems sending or receiving facsimile you can
enable copious tracing information by editing the HylaFAX
configuration files.
Consult the <A HREF="troubleshooting.html">Troubleshooting</A>
section and the
<A HREF="@CGIPATH@/manpage?hylafax-config">config</A> manual page,
in particular, for help.
There is also information in the
<A HREF="http://www.hylafax.org/FAQ/">HylaFAQ</A> on problems one might encounter during
server operation.

<A NAME="Control"><P><HR WIDTH=65% ALIGN=right><H3>Controlling Modem Usage</A></H3>

HylaFAX provides a great of flexibility in how modems on a server
machine are used.
Modems can be constrained for outbound-only use, inbound-only use, or both.
Modem priorities (see the section in the
``<A HREF=setup-advanced.html#ModemPriority>Advanced Server Setup</A>'' chapter)
can be used to control the order in which modems are assigned to outbound
jobs.
Modems can also be dynamically <I>taken off-line</I> for either inbound or
outbound use by using the faxstate or faxconfig commands.
For example, to mark a modem as ``busy'' or ``down'' so that it is not
assigned to an outbound job the faxstate command would be used:

<UL><TT>
<PRE>hyla# <B>faxstate -s busy ttyf2</B></PRE>
</TT></UL>

To temporarily disable the answering of inbound calls on a modem one
could use faxconfig:

<UL><TT>
<PRE>hyla# <B>faxconfig -m ttyf2 RingsBeforeAnswer 0</B></PRE>
</TT></UL>

Similarly, it is easy to constrain a modem so that only inbound
data calls are accepted during part of the day with either data
or facsimile calls the rest by using simple shell scripts that are
invoked by cron.
The most flexibility is available when using faxgetty to control
modems.

<!--FOOTER-->

<P>
<TABLE BORDER=0 WIDTH=100%>
<TR>
<TD><A HREF="documentation.html"><IMG SRC="icons/next.gif">
HylaFAX documentation</A>.</TD>
<TD><A HREF="toc.html"><IMG SRC="icons/back.gif">
HylaFAX table of contents</A>.</TD>
</TR>
</TABLE>

<HR>

<ADDRESS>
<A HREF="sam.html">Sam Leffler</A> / <A HREF="mailto:sam@engr.sgi.com">sam@engr.sgi.com</A>.
Last updated $Date$.
</ADDRESS>

</BODY>
</HTML>
